{%- liquid
  assign poster = section.settings.video.preview_image | default: section.settings.cover_image
  if section.settings.video_mobile
    assign poster_mobile = section.settings.video_mobile.preview_image | default: section.settings.cover_image_mobile
  endif
-%}

<style>
  #shopify-section-{{ section.id }} {
    --section-padding-top: {{ section.settings.padding_top }}px;
    --section-padding-bottom: {{ section.settings.padding_bottom }}px;
    --text-color: {{ section.settings.color_text }};
    --background-color: {{ section.settings.color_background }};
    --gradient-overlay: {{ section.settings.gradient_overlay }};
    --rounded-corner-radius: {% if section.settings.rounded %}15px{% else %}0px{% endif %};
    --overlap-amount: {{ section.settings.overlap_amount }}px;
  }

  .goboat-hero {
    background: var(--background-color);
    width: 100vw;
    overflow: hidden;
  }

  .goboat-hero .banner__media {
    width: 100%;
    height: auto;
  }

  .goboat-hero .banner__image {
    width: 100%;
    height: auto;
    object-fit: cover;
    border-radius: var(--rounded-corner-radius);
  }

  .goboat-hero .banner__overlay {
    background-image: var(--gradient-overlay);
    opacity: 1;
  }

  .goboat-hero .video-container {
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
    z-index: 10;
    overflow: hidden;
    border-radius: var(--rounded-corner-radius);
  }

  .goboat-hero .video-container iframe,
  .goboat-hero .video-container video {
    width: 100%;
    height: auto;
    border-radius: var(--rounded-corner-radius);
  }

  /* Overlap Section */
  .goboat-hero .overlap-section + .video-container {
    margin-top: calc((var(--overlap-amount) + clamp(3rem, 4.78vw + 1.47rem, 10rem)) * -1);
  }

  @media screen and (max-width: 767px) {
    .goboat-hero .overlap-section + .video-container {
      margin-top: 0;
    }
  }
</style>

<div
  class="goboat-hero section--padding{% if section.settings.divider %} section--divider{% endif %}"
  style="background: var(--background-color); width: 100vw; overflow: hidden;"
>
  <div class="{% unless section.settings.full_width %}page-width {% endunless %} relative">
    {%- if section.blocks.size > 0 -%}
      {%- assign block = section.blocks | first -%}
      <div class="relative">
        <div
          class="banner w-full overflow-hidden overlap-section"
          data-type="image"
          {{ block.shopify_attributes }}
          style="border-radius: var(--rounded-corner-radius); position: relative;"
        >
          <media-element class="banner__media block w-full h-auto">
            <img
              src="{{ block.settings.image | image_url: width: 3000 }}"
              srcset="
                {{ block.settings.image | image_url: width: 400 }} 400w,
                {{ block.settings.image | image_url: width: 800 }} 800w,
                {{ block.settings.image | image_url: width: 1200 }} 1200w,
                {{ block.settings.image | image_url: width: 1600 }} 1600w,
                {{ block.settings.image | image_url: width: 2000 }} 2000w,
                {{ block.settings.image | image_url: width: 2400 }} 2400w,
                {{ block.settings.image | image_url: width: 2800 }} 2800w,
                {{ block.settings.image | image_url: width: 3200 }} 3200w
              "
              sizes="100vw"
              loading="lazy"
              fetchpriority="high"
              alt="{{ block.settings.image.alt }}"
              class="banner__image"
              style="width: 100%; height: auto; object-fit: cover; border-radius: var(--rounded-corner-radius);"
            >
          </media-element>
          <span
            class="banner__overlay absolute top-0 left-0 w-full h-full pointer-events-none"
            style="background-image: var(--gradient-overlay);"
          ></span>
        </div>
        <div class="video-container relative z-10">
          {%- capture sizes -%}{% if section.settings.full_width %}100vw{% else %}min({{ settings.page_width }}px, 100vw){% endif %}{%- endcapture -%}
          {%- if section.settings.video_mobile or section.settings.video_url_mobile -%}
            {%- render 'video',
              sizes: sizes,
              video: section.settings.video_mobile,
              video_url: section.settings.video_url_mobile,
              muted: section.settings.enable_video_autoplay,
              autoplay: section.settings.enable_video_autoplay,
              loop: section.settings.enable_video_looping,
              description: section.settings.description,
              cover_image: section.settings.cover_image_mobile,
              show_play_button: true,
              is_mobile: true,
              class: 'banner__media media media--height w-full h-full relative'
            -%}
          {%- else -%}
            {%- render 'video',
              sizes: sizes,
              video: section.settings.video,
              video_url: section.settings.video_url,
              muted: section.settings.enable_video_autoplay,
              autoplay: section.settings.enable_video_autoplay,
              loop: section.settings.enable_video_looping,
              description: section.settings.description,
              cover_image: section.settings.cover_image,
              show_play_button: true,
              class: 'banner__media media media--height w-full h-full relative'
            -%}
          {%- endif -%}
        </div>
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "GoBoat Hero with Video",
  "settings": [
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 0
    },
    {
      "type": "checkbox",
      "id": "divider",
      "label": "Divider",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full Width",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "rounded",
      "label": "Rounded Corners",
      "default": false
    },
    {
      "type": "range",
      "id": "overlap_amount",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Overlap Amount",
      "default": 50
    },
    {
      "type": "color",
      "id": "color_text",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "color_background",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color_background",
      "id": "gradient_overlay",
      "label": "Gradient Overlay"
    },
    {
      "type": "video",
      "id": "video",
      "label": "Shopify Hosted Video (Desktop)"
    },
    {
      "type": "video_url",
      "id": "video_url",
      "label": "Embed Video URL (Desktop)",
      "accept": ["youtube", "vimeo"],
      "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc"
    },
    {
      "type": "image_picker",
      "id": "cover_image",
      "label": "Video Cover Image (Desktop)"
    },
    {
      "type": "video",
      "id": "video_mobile",
      "label": "Shopify Hosted Video (Mobile)"
    },
    {
      "type": "video_url",
      "id": "video_url_mobile",
      "label": "Embed Video URL (Mobile)",
      "accept": ["youtube", "vimeo"]
    },
    {
      "type": "image_picker",
      "id": "cover_image_mobile",
      "label": "Video Cover Image (Mobile)"
    },
    {
      "type": "text",
      "id": "description",
      "label": "Video Description"
    },
    {
      "type": "checkbox",
      "id": "enable_video_autoplay",
      "label": "Enable Video Autoplay",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_video_looping",
      "label": "Enable Video Looping",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Hero Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Desktop Image"
        },
        {
          "type": "image_picker",
          "id": "image_mobile",
          "label": "Mobile Image"
        }
      ],
      "limit": 1
    }
  ],
  "presets": [
    {
      "name": "GoBoat Hero with Video",
      "blocks": [
        {
          "type": "image"
        }
      ]
    }
  ]
}
{% endschema %}
